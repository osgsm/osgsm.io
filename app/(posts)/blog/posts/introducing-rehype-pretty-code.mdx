---
title: "Rehype Pretty Code ã‚’ä½¿ã£ã¦ã€ç¾ã—ãã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ‰‹ã«å…¥ã‚Œã‚‹"
time:
  created: "2023-01-16T15:00:00.000Z"
  updated: "2024-12-14T14:45:58.518Z"
---

æŠ€è¡“ç³»ãƒ–ãƒ­ã‚°ã‚’æ›¸ããªã‚‰ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã¯å¿…é ˆã§ã™ã‚ˆã­ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€ä»Šå›ã¯ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®å°å…¥ã‚’è¡Œã£ã¦ã„ãã¾ã™ã€‚

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ã¯ã€Rehype Pretty Code ã¨ã„ã† rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã„ã¾ã™ã€‚ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ã€ [Shiki](https://shiki.matsu.io/) ã‚’ä½¿ã£ã¦ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’è¡Œã„ã¾ã™ã€‚

ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã¨ã„ãˆã° [Prism](https://prismjs.com) ãŒæœ‰åã§ã™ãŒã€ä»Šå›ã¯ Shiki ã‚’ä½¿ç”¨ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

## Prism ã‚ˆã‚Šã‚‚ Shiki ãŒã‚ˆã•ãã†

ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®å°å…¥ã«ã‚ãŸã‚Šã€ã‚°ã‚°ã£ã¦ã¿ãŸã¨ã“ã‚ [Prism](https://prismjs.com) ã¯ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ç²¾åº¦ãŒå®Œå…¨ã§ãªãã€å´©ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‚ˆã†ã§ã—ãŸã€‚â†’ [syntax highlighter ã‚’ shiki ã«åˆ‡ã‚Šæ›¿ãˆãŸ | blog.ojisan.io](https://blog.ojisan.io/use-shiki/) å‚ç…§ã€‚

ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ç²¾åº¦ã§ã¯ã€Prism ã‚ˆã‚Šã‚‚ [Shiki](https://shiki.matsu.io/) ã«è»é…ãŒä¸ŠãŒã‚‹ã‚ˆã†ã§ã€ã—ã‹ã‚‚ Shiki ã§ã¯ã€ Visual Studio Code ã®ãƒ†ãƒ¼ãƒãŒä½¿ãˆã¾ã™ã€‚

ã¡ãªã¿ã«ã€ä»Šè©±é¡Œã® [Astro](https://astro.build/) ã§ã‚‚ã€ Shiki ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã¨ã—ã¦ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚â†’ [Markdown & MDX ğŸš€ Astro Documentation](https://docs.astro.build/en/guides/markdown-content/#syntax-highlighting) å‚ç…§ã€‚

ãã‚“ãªã‚ã‘ã§ã€ Shiki ã‚’ä½¿ã†ã®ãŒã‚ˆã‹ã‚ã†ã¨çµè«–ã—ã¾ã—ãŸã€‚

ã§ã€ Shiki ã‚’ä½¿ã†ãŸã‚ã«è‰²ã€…ã¨èª¿ã¹ã¦ã„ã‚‹ã¨ãã«å‡ºä¼šã£ãŸã®ãŒ [Rehype Pretty Code](https://rehype-pretty-code.netlify.app/) (`rehype-pretty-code`) ã¨ã„ã† rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

ã¡ãªã¿ã«ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€ [Next.jsã§ãƒ–ãƒ­ã‚°ã‚’ã¤ãã£ãŸ | ç¥è©±å‹Ÿé›†ä¸­](https://www.haxibami.net/blog/posts/blog-renewal) ã¨ã„ã†è¨˜äº‹ã‚’è¦‹ã¦çŸ¥ã‚Šã¾ã—ãŸã€‚ç­†è€…ã®æ–¹ã«æ„Ÿè¬ã§ã™ã€‚

## Rehype Pretty Code ã¨ã¯ï¼Ÿ

[Rehype Pretty Code](https://rehype-pretty-code.netlify.app/) ã¯ã€MD/MDX ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ç¾ã—ã„ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

ä»Šå›ã¯è©³ã—ãæ›¸ãã¾ã›ã‚“ãŒã€ç‰¹å®šã®è¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚„è¡Œç•ªå·ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«åã®è¡¨ç¤ºãªã©ã‚‚è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°æ¬¡ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```js showLineNumbers title="add.js" {3}
const add = (a, b) => a + b;

add(2, 3); // 5
```

è¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚„è¡Œç•ªå·ãƒ»ãƒ•ã‚¡ã‚¤ãƒ«åã®è¡¨ç¤ºã«ã¤ã„ã¦ã¯ã€å¾Œæ—¥æ”¹ã‚ã¦è¨˜äº‹ã«ã™ã‚‹äºˆå®šã§ã™ã€‚

## Rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ãŸã‚ã®æº–å‚™

ã“ã®ãƒ–ãƒ­ã‚°ã¯ Next.js ã®å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’ã‚‚ã¨ã«ä½œã£ã¦ã„ã¦ã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’ HTML ã«å¤‰æ›ã™ã‚‹ãŸã‚ã« `remark` ã¨ `remark-html` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

`remark-html` ã¯ã€ `.use(remarkRehype).use(rehypeStringify)` ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã«ã‚ãŸã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ãŒã€ rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã†ãŸã‚ã«ã¯ `remark-rehype` ã¨ `remark-stringify` ã‚’åˆ¥ã€…ã§ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãªã®ã§ã€ `remark-html` ã‚’å–ã‚Šé™¤ãã€

```shell title="Terminal"
yarn remove remark-html
```

`remark-rehype` ã¨ `rehype-stringify` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ã‚‡ã†ã€‚

```shell title="Terminal"
yarn add remark-rehype rehype-stringify
```

ãã—ã¦ãã‚Œã‚‰ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã« `lib/posts.js` ã§ã€ãã‚Œã‚‰ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã€`remark-html` ã¯å‰Šé™¤ã—ã¾ã™ã€‚

```diff title="lib/posts.js" {6-7}
import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';
import { remark } from 'remark';
- import html from 'remark-html';
+ import remarkRehype from 'remark-rehype';
+ import rehypeStringify from 'rehype-stringify';
```

æ¬¡ã«ã€ãã‚Œã‚‰ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ `getPostData` ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

```diff title="lib/posts.js" {9-10}
export const getPostData = async (id) => {
  const fullPath = path.join(postsDirectory, `${id}.md`);
  const fileContents = fs.readFileSync(fullPath, 'utf8');

  const matterResult = matter(fileContents);

  const processedContent = await remark()
-   .use(html)
+   .use(remarkRehype)
+   .use(rehypeStringify)
    .process(matterResult.content);
  const contentHtml = processedContent.toString();

  return {
    id,
    contentHtml,
    ...matterResult.data,
  };
};
```

ä»Šå›è¿½åŠ ã—ãŸ `.use(remarkRehype)` ã¨ `.use(rehypeStringify)` ã®é–“ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã§ rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€ã“ã“ã« `rehype-pretty-code` ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

## Rehype Pretty Code ã®å°å…¥

Rehype ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚‹æº–å‚™ãŒã§ããŸã®ã§ã€ `rehype-pretty-code` ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ã¾ãšã¯ [å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rehype-pretty-code.netlify.app/)ã«æ²¿ã£ã¦ã€å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell title="Terminal"
yarn add rehype-pretty-code shiki
```

æ¬¡ã« `lib/posts.js` ã§ `rehype-pretty-code` ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```jsx title="lib/posts.js" {6}
import fs from "fs";
import path from "path";

import matter from "gray-matter";
import rehypePrettyCode from "rehype-pretty-code";
import rehypeStringify from "rehype-stringify";
import remarkRehype from "remark-rehype";
```

ãã—ã¦ã€ãã‚Œã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã« `getPostData` ã‚’å¤‰æ›´ã—ã¾ã™ã€‚ æ¬¡ã®ã‚ˆã†ã« `.use(rehypePrettyCode)` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```jsx title="lib/posts.js" {9}
export const getPostData = async (id) => {
  const fullPath = path.join(postsDirectory, `${id}.md`);
  const fileContents = fs.readFileSync(fullPath, "utf8");

  const matterResult = matter(fileContents);

  const processedContent = await remark()
    .use(remarkRehype)
    .use(rehypePrettyCode)
    .use(rehypeStringify)
    .process(matterResult.content);
  const contentHtml = processedContent.toString();
  return {
    id,
    contentHtml,
    ...matterResult.data,
  };
};
```

ã“ã‚Œã§ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆãŒåŠ¹ãã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ãƒ†ãƒ¼ãƒã‚’å¤‰æ›´ã—ã¦ã¿ã‚‹

ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ãƒ†ãƒ¼ãƒã¯ã€å€‹äººçš„ã« One Dark Pro ãŒå¥½ã¿ãªã®ã§ã€ãã‚Œã«å¤‰æ›´ã—ã¦ã¿ã¾ã™ã€‚

ãƒ†ãƒ¼ãƒã®å¤‰æ›´ã¯ç°¡å˜ã§ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½¿ç”¨æ™‚ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦æŒ‡å®šã™ã‚‹ã ã‘ã§ã™ã€‚ Shiki ã«å«ã¾ã‚Œã‚‹ãƒ†ãƒ¼ãƒã§ã‚ã‚Œã°æ–‡å­—åˆ—ã‚’æ¸¡ã™ã ã‘ã§ OK ã§ã™ã€‚

æ¬¡ã®ã‚³ãƒ¼ãƒ‰ä¾‹ã®ã‚ˆã†ã« `theme: 'one-dark-pro'` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

ä½µã›ã¦è¿½è¨˜ã—ã¦ã„ã‚‹ `keepBackground: true` ã¨ã„ã†ã®ã¯ã€ãƒ†ãƒ¼ãƒã«è¨­å®šã•ã‚Œã¦ã„ã‚‹èƒŒæ™¯è‰²ã‚’ä½¿ã†ãŸã‚ã®æŒ‡å®šã§ã™ã€‚è‡ªèº«ã§è¨­å®šã—ãŸèƒŒæ™¯è‰²ã‚’ä½¿ã„ãŸã„å ´åˆã¯ `false` ã«ã—ã¦ãã ã•ã„ã€‚

```jsx {3-6}
const processedContent = await remark()
  .use(remarkRehype)
  .use(rehypePrettyCode, {
    theme: "one-dark-pro",
    keepBackground: true,
  })
  .use(rehypeStringify)
  .process(matterResult.content);
```

ã¡ãªã¿ã« Shiki ã«å«ã¾ã‚Œã‚‹ãƒ†ãƒ¼ãƒã¯ [shiki/themes.md > All Themes](https://github.com/shikijs/shiki/blob/main/docs/themes.md#all-themes) ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚

Shiki ã«å«ã¾ã‚Œã¦ã„ãªã„ãƒ†ãƒ¼ãƒã§ã‚‚ã€ JSON ãŒã‚ã‚Œã°ãã‚Œã‚’èª­ã¿è¾¼ã‚“ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚è©³ã—ãã¯[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://rehype-pretty-code.netlify.app/)ã‚’ã”å‚ç…§ã‚ã‚Œã€‚

## ã•ã„ã”ã«

ã“ã‚Œã§ã€ã‚ˆã†ã‚„ãã“ã®ãƒ–ãƒ­ã‚°ã«ã‚‚ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆãŒé©ç”¨ã•ã‚Œã¾ã—ãŸã€‚

Rehype Pretty Code ã«ã¯ã€ä»–ã«ã‚‚ä¾¿åˆ©ãªæ©Ÿèƒ½ãŒã‚ã‚Šã€ç‰¹å®šã®è¡Œã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚„è¡Œç•ªå·ã‚’è¡Œã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

ã“ã®è¾ºã«ã¤ã„ã¦ã¯ã€å¾Œæ—¥æ”¹ã‚ã¦è¨˜äº‹ã‚’å…¬é–‹ã™ã‚‹äºˆå®šã§ã™ã®ã§ãŠæ¥½ã—ã¿ã«ï¼

---

å‚è€ƒ

- [Rehype Pretty Code](https://rehype-pretty-code.netlify.app/)
- [atomiks/rehype-pretty-code: Beautiful code blocks for your MD/MDX docs](https://github.com/atomiks/rehype-pretty-code)
- [shiki/themes.md at main Â· shikijs/shiki](https://github.com/shikijs/shiki/blob/main/docs/themes.md)
